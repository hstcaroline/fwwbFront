<!DOCTYPE html>
<!--[if IE 8]>
<html lang="en" class="ie8 no-js"> <![endif]-->
<!--[if IE 9]>
<html lang="en" class="ie9 no-js"> <![endif]-->
<!--[if !IE]><!-->
<html lang="en" class="no-js"> <!--<![endif]-->
<!-- BEGIN HEAD -->
<head>
    <meta charset="utf-8"/>
    <title>司机排班 | 厂车管理系统</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <meta content="" name="description"/>
    <meta content="" name="author"/>
    <!-- BEGIN GLOBAL MANDATORY STYLES -->
    <link href="media/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
    <link href="media/css/bootstrap-responsive.min.css" rel="stylesheet" type="text/css"/>
    <link href="media/css/font-awesome.min.css" rel="stylesheet" type="text/css"/>
    <link href="media/css/style-metro.css" rel="stylesheet" type="text/css"/>
    <link href="media/css/style.css" rel="stylesheet" type="text/css"/>
    <link href="media/css/style-responsive.css" rel="stylesheet" type="text/css"/>
    <link href="media/css/default.css" rel="stylesheet" type="text/css" id="style_color"/>
    <link href="media/css/uniform.default.css" rel="stylesheet" type="text/css"/>
    <link href="media/css/jquery.gridster.min.css" rel="stylesheet" type="text/css"/>
    <!-- END GLOBAL MANDATORY STYLES -->
    <link rel='stylesheet' type='text/css' href='media/css/jquery-ui-1.8.11.custom.css'/>
    <link rel='stylesheet' type='text/css' href='media/css/jquery.weekcalendar.css'/>
    <link href="media/css/mystyle.css" rel="stylesheet" type="text/css"/>
    <style type='text/css'>

    </style>
</head>
<!-- END HEAD -->

<!-- BEGIN BODY -->
<body class="page-header-fixed page-full-width">
<!-- BEGIN HEADER -->
<div class="header navbar navbar-inverse navbar-fixed-top">

    <!-- BEGIN TOP NAVIGATION BAR -->

    <div class="navbar-inner">

        <div class="container-fluid">

            <!-- BEGIN LOGO -->
            <a class="brand" href="index.html">
                <img src="media/image/logo.png" alt="logo">
            </a>
            <!-- END LOGO -->
            <!-- BEGIN HORIZANTAL MENU -->
            <div class="navbar hor-menu hidden-phone hidden-tablet">
                <div class="navbar-inner">
                    <ul class="nav">
                        <li>
                            <a href="index.html">
                                线路规划
                            </a>
                        </li>
                        <li>
                            <a href="realTime.html">
                                运行动态
                            </a>
                        </li>
                        <li class="active">

                            <a data-toggle="dropdown" class="dropdown-toggle" href="javascript:;">

                                <span class="selected"></span>

                                目录

                                <span class="arrow"></span>

                            </a>

                            <ul class="dropdown-menu">

                                <li class="dropdown-submenu">

                                    <a href="javascript:;">

                                        数据查询

                                        <span class="arrow"></span>

                                    </a>

                                    <ul class="dropdown-menu">
                                        <li>
                                            <a href="stationInfo.html">
                                                所有站点</a>
                                        </li>
                                        <li>
                                            <a href="rideList.html">
                                                乘车名单</a>
                                        </li>
                                        <li>
                                            <a href="reportForm.html">
                                                报表</a>
                                        </li>
                                    </ul>

                                </li>
                                <li class="dropdown-submenu">

                                    <a href="javascript:;">

                                        信息管理

                                        <span class="arrow"></span>
                                    </a>

                                    <ul class="dropdown-menu">

                                        <li>
                                            <a href="staffInfo.html">
                                                员工</a>
                                        </li>
                                        <li>
                                            <a href="carInfo.html">
                                                车辆</a></li>
                                        <li>
                                            <a href="driverSchedule.html">
                                                司机排班</a>
                                        </li>

                                    </ul>

                                </li>
                                <li class="dropdown-submenu">

                                    <a href="javascript:;">

                                        系统管理

                                        <span class="arrow"></span>
                                    </a>

                                    <ul class="dropdown-menu">

                                        <li class="dropdown-submenu">

                                            <a href="javascript:;">角色管理<span class="arrow"></span></a>

                                            <ul class="dropdown-menu">

                                                <li><a href="role_create.html">创建角色</a></li>
                                                <li><a href="role_edit.html">更改角色</a></li>

                                            </ul>

                                        </li>
                                        <li>
                                            <a href="authorityMng.html">
                                                权限管理</a></li>
                                        <li>
                                            <a href="register.html">
                                                创建用户</a>
                                        </li>

                                    </ul>

                                </li>

                                <li class="dropdown-submenu">

                                    <a href="javascript:;">

                                        个人中心

                                        <span class="arrow"></span>

                                    </a>

                                    <ul class="dropdown-menu">

                                        <li class="dropdown-submenu">

                                            <a href="javascript:;">个人账户<span class="arrow"></span></a>

                                            <ul class="dropdown-menu">

                                                <li><a href="userProfile.html">个人资料</a></li>

                                                <li><a href="changePsw.html">更改密码</a></li>
                                            </ul>

                                        </li>

                                        <li class="dropdown-submenu">

                                            <a href="javascript:;">我的日程<span class="arrow"></span></a>

                                            <ul class="dropdown-menu">

                                                <li><a href="index.html">待办事项</a></li>

                                                <li><a href="index.html">全部日程</a></li>
                                                <li><a href="index.html">新建任务</a></li>
                                            </ul>

                                        </li>
                                        <li class="dropdown-submenu">

                                            <a href="javascript:;">我的日程<span class="arrow"></span></a>

                                            <ul class="dropdown-menu">

                                                <li><a href="index.html">消息中心</a></li>

                                                <li><a href="index.html">申请与建议</a></li>
                                                <li><a href="index.html">收件箱</a></li>
                                                <li><a href="index.html">发件箱</a></li>
                                            </ul>

                                        </li>


                                    </ul>

                                </li>

                                <li>

                                    <a href="news.html">
                                        公司动态 </a>

                                </li>

                            </ul>

                            <b class="caret-out"></b>

                        </li>


                    </ul>

                </div>

            </div>


            <!-- END HORIZANTAL MENU -->

            <!-- BEGIN TOP NAVIGATION MENU -->

            <ul class="nav pull-right">
                <!-- BEGIN TODO DROPDOWN -->
                <li class="dropdown" id="header_task_bar">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                        <i class="icon-tasks"></i>
                        <span class="badge">4</span>
                    </a>
                    <ul class="dropdown-menu extended tasks">
                        <li>
                            <p>您有 4 个更新状态</p>
                        </li>
                        <li>
                            <a href="#">
                                        <span class="task">
                                        <span class="desc">车辆信息更新</span>
                                        <span class="percent">40%</span>
                                        </span>
                                        <span class="progress progress-success ">
                                        <span style="width: 40%;" class="bar"></span>
                                        </span>
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                    <span class="task">
                                    <span class="desc">员工信息更新</span>
                                    <span class="percent">65%</span>
                                    </span>
                                    <span class="progress progress-danger progress-striped active">
                                    <span style="width: 65%;" class="bar"></span>
                                    </span>
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                    <span class="task">
                                    <span class="desc">排班信息更新</span>
                                    <span class="percent">10%</span>
                                    </span>
                                    <span class="progress progress-warning progress-striped">
                                    <span style="width: 10%;" class="bar"></span>
                                    </span>
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                    <span class="task">
                                    <span class="desc">站点信息更新</span>
                                    <span class="percent">30%</span>
                                    </span>
                                    <span class="progress progress-info progress-striped">
                                    <span style="width: 30%;" class="bar"></span>
                                    </span>
                            </a>
                        </li>
                        <li class="external">
                            <a href="timeSchedule.html">修改更新计划 <i class="m-icon-swapright"></i></a>
                        </li>
                    </ul>
                </li>
                <!-- END TODO DROPDOWN -->

                <!-- BEGIN INBOX DROPDOWN -->
                <li class="dropdown" id="header_inbox_bar">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                        <i class="icon-envelope"></i>
                        <span class="badge">12</span>
                    </a>
                    <ul class="dropdown-menu extended inbox">
                        <li>
                            <p>您有12条未读消息</p>
                        </li>
                        <li>
                            <a href="inbox.html?a=view">
                                <span class="photo"><img src="media/image/avatar2.jpg" alt=""/></span>
                                        <span class="subject">
                                        <span class="from">刘婷</span>
                                        <span class="time">刚刚</span>
                                        </span>
                                        <span class="message">
                                       排班信息更改请求...
                                        </span>
                            </a>
                        </li>
                        <li>
                            <a href="inbox.html?a=view">
                                <span class="photo"><img src="./media/image/avatar3.jpg" alt=""/></span>
                                    <span class="subject">
                                    <span class="from">李宁</span>
                                    <span class="time">16 分钟以前</span>
                                    </span>
                                    <span class="message">
                                    站点变更请求...
                                    </span>
                            </a>
                        </li>
                        <li>
                            <a href="inbox.html?a=view">
                                <span class="photo"><img src="./media/image/avatar1.jpg" alt=""/></span>
                                    <span class="subject">
                                    <span class="from">黄雷</span>
                                    <span class="time">2 小时以前</span>
                                    </span>
                                    <span class="message">
                                    数据更新请求...
                                    </span>
                            </a>
                        </li>
                        <li class="external">
                            <a href="#">查看所有消息 <i class="m-icon-swapright"></i></a>
                        </li>
                    </ul>
                </li>
                <!-- END INBOX DROPDOWN -->

                <!-- BEGIN USER LOGIN DROPDOWN -->
                <li class="dropdown user">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                        <img alt="" src="media/image/avatar1_small.jpg"/>
                        <span class="username">曾林（Pyxister管理员）</span>
                        <i class="icon-angle-down"></i>
                    </a>
                    <ul class="dropdown-menu">
                        <li><a href="userProfile.html"><i class="icon-user"></i> 个人资料</a></li>
                        <li><a href="page_calendar.html"><i class="icon-calendar"></i> 我的日程</a></li>
                        <li><a href="inbox.html"><i class="icon-envelope"></i> 我的消息 (12)</a></li>
                        <li><a href="#"><i class="icon-tasks"></i> 待办事项 (3)</a></li>
                        <li class="divider"></li>
                        <li><a href="extra_lock.html"><i class="icon-lock"></i> 锁屏</a></li>
                        <li><a href="login.html"><i class="icon-power-off"></i> 注销</a></li>
                    </ul>
                </li>
                <!-- END USER LOGIN DROPDOWN -->
            </ul>

            <!-- END TOP NAVIGATION MENU -->

        </div>

    </div>

    <!-- END TOP NAVIGATION BAR -->

</div>
<!-- END HEADER -->
<!-- BEGIN CONTAINER -->
<div class="page-container">
    <!-- BEGIN PAGE -->
    <div class="page-content">
        <div class="container-fluid">
            <div class="row-fluid">
                <div class="span12">
                </div>
            </div>
            <!--开始内容-->
            <div class="row-fluid">
                <div class="tabbable tabbable-custom">

                    <ul class="nav nav-tabs">
                        <li class="active"><a href="#tab_week" data-toggle="tab">按周统计</a></li>
                        <li class=""><a href="driverMonthSchedule.html">按月统计</a></li>
                    </ul>

                    <div class="tab-content">
                        <div class="tab-pane active" id="tab_week">
                            <div class="portlet-body light-grey">
                                <div class="row-fluid">
                                    <div class="span12">
                                        <div class="span2 responsive span12 fix-margin" data-tablet="span12 fix-margin"
                                             data-desktop="span8">

                                            <!-- BEGIN DRAGGABLE EVENTS PORTLET-->
                                            <h3 class="event-form-title">可拖拽修改</h3>
                                            <h5 class="event-form-title">点击日历空白处可以添加排班信息</h5>
                                            <div id="external-events">
                                                <form class="inline-form">
                                                    <input type="text" value="" class="m-wrap span12"
                                                           placeholder="Event Title..." id="event_title"><br>
                                                    <a href="javascript:;" onclick="saveSchedule() " class="btn green">保存</a>

                                                </form>
                                                <hr>

                                                <hr class="visible-phone">

                                            </div>

                                            <!-- END DRAGGABLE EVENTS PORTLET-->
                                        </div>
                                        <div class="span10">
                                            <div id="calendar"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                        <div class="tab-pane " id="tab_month">
                            <div class="row-fluid">
                                <div class="span12">
                                    <!-- BEGIN BORDERED TABLE PORTLET-->
                                    <div class="portlet box yellow">
                                        <div class="portlet-title">
                                            <div class="caption"><i class="icon-coffee"></i>月排班表</div>
                                        </div>

                                        <div class="portlet-body">
                                            <table class="table table-bordered table-hover">
                                                <thead>
                                                <tr>
                                                    <th>#</th>
                                                    <th>线路</th>
                                                    <th>司机</th>
                                                    <th>车牌</th>
                                                    <th>时间段</th>
                                                    <th>是否缺勤</th>
                                                </tr>
                                                </thead>

                                                <tbody id="tableBody">
                                                </tbody>

                                            </table>

                                        </div>

                                    </div>
                                    <!-- END BORDERED TABLE PORTLET-->

                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
    <!-- END PAGE CONTAINER-->

</div>
<button class="btn btn-primary btn-lg hide" data-toggle="modal"
        data-target="#myModal" id="showModalBtn">
    开始演示模态框
</button>
<!-- 模态框（Modal） -->
<div class="modal fade" style="display: none" id="myModal" tabindex="-1" role="dialog"
     aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close"
                        data-dismiss="modal" aria-hidden="true">
                </button>
                <h4 class="modal-title" id="myModalLabel">
                    选择司机和车辆
                </h4>
            </div>
            <div class="modal-body">
                <form role="form">
                    <div class="form-group">
                        <label for="driver">司机姓名</label>
                        <select class="form-control" id="driver">
                            <option value="1">司机1</option>
                            <option value="2">司机2</option>
                            <option value="3">司机3</option>
                            <option value="4">司机4</option>
                            <option value="5">司机5</option>
                        </select>
                        <label for="bus">车牌号</label>
                        <select class="form-control" id="bus">
                            <option value="1">厂车1</option>
                            <option value="2">厂车2</option>
                            <option value="3">厂车3</option>
                            <option value="4">厂车4</option>
                            <option value="5">厂车5</option>
                        </select>

                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn red"
                        data-dismiss="modal">取消
                </button>
                <button type="button" class="btn green" id="submitBtn" data-dismiss="modal" aria-hidden="true">
                    确定
                </button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal -->
</div>
<!-- END PAGE -->
<!-- END CONTAINER -->

<!-- BEGIN JAVASCRIPTS(Load javascripts at bottom, this will reduce page load time) -->
<!-- BEGIN CORE PLUGINS -->

<script src="media/js/jquery-1.10.1.min.js" type="text/javascript"></script>
<script src="media/js/jquery-migrate-1.2.1.min.js" type="text/javascript"></script>
<!-- IMPORTANT! Load jquery-ui-1.10.1.custom.min.js before bootstrap.min.js to fix bootstrap tooltip conflict with jquery ui tooltip -->
<script src="media/js/jquery-ui-1.10.1.custom.min.js" type="text/javascript"></script>
<script src="media/js/bootstrap.min.js" type="text/javascript"></script>
<!--[if lt IE 9]>
<script src="media/js/excanvas.min.js"></script>
<script src="media/js/respond.min.js"></script>
<![endif]-->
<script src="media/js/app.js"></script>
<script src="media/js/jquery.gridster.js" type="text/javascript" charset="utf-8"></script>

<script src="media/js/calendar/jquery-1.4.4.min.js" type="text/javascript"></script>
<script type='text/javascript' src='media/js/calendar/jquery-ui-1.8.11.custom.min.js'></script>

<script type="text/javascript" src="media/js/calendar/date.js"></script>
<script type='text/javascript' src='media/js/calendar/jquery.weekcalendar.js'></script>

<script type='text/javascript'>
    $.ajaxSetup({
        async: false,
    });
    var url = ip + '/users/getRouteDriverByDate';
    var eventData = {
        options: {
            allowEventDelete: true,
            allowEventResize: false,
            eventDelete: function (calEvent, element, dayFreeBusyManager, calendar, clickEvent) {
                if (confirm('你确定要删除该排班信息吗?')) {
                    calendar.weekCalendar('removeEvent', calEvent.id);
                }
            },
            deletable: function (calEvent, element) {
                return calEvent.date > Date.today();
            }
        },
        events: [
            {
                'id': 2,
                "date": new Date(2016, 6, 27),
                "status": "ready",
                'driver': {
                    "id": 2,
                    "name": "司机B"
                },
                "route": {
                    "id": 29,
                    "name": "route",
                    "time": null,
                    "status": "ok"
                },
                "bus": {
                    id: 1,
                    plate_number: 'A234'
                }
            }, {
                'id': 3,
                "date": new Date(2016, 6, 30),
                "status": "ready",
                'driver': {
                    "id": 3,
                    "name": "司机C"
                },
                "route": {
                    "id": 36,
                    "name": "route",
                    "time": null,
                    "status": "ok"
                },
                "bus": {
                    id: 1,
                    plate_number: 'A234'
                }
            }
        ],
        allRoute: [
//            {
//                "id": 29,
//                "name": "route1",
//                "time": 5
//            },
//            {
//                "id": 31,
//                "name": "route2",
//                "time": 7
//            },
//            {
//                "id": 34,
//                "name": "route3",
//                "time": 10
//            },
//            {
//                "id": 35,
//                "name": "route4",
//                "time": 5
//            },
//            {
//                "id": 36,
//                "name": "route5",
//                "time": 8
//            },
//            {
//                "id": 37,
//                "name": "route6",
//                "time": 8
//            }, {
//                "id": 38,
//                "name": "route7",
//                "time": 8
//            }, {
//                "id": 39,
//                "name": "route8",
//                "time": 8
//            }
        ]
    }

    $(document).ready(function () {
//        getData();
          showCalendar();
        //  loadTable();
    });
    function getData() {
        var postData =
        {
            "startdate": "2016-7-24",
            "enddate": "2016-7-30"
        };
        //获取所有线路
        $.get(ip + '/users/getRoutename', function (data) {
            allRoute = data;
        });
//        获取当前时间段的所有排班信息
        $.post(ip + '/users/getRouteDriverByDate', postData, function (data) {
            for (var i in data) {
                data[i].date = new Date(data[i].date);
            }
            eventData.events = data;
            eventData.allRoute = allRoute;
        });


    }
    function showCalendar() {

        $('#calendar').weekCalendar({
            data: eventData,
            timeslotsPerHour: 1,
            allowCalEventOverlap: false,
            overlapEventsSeparate: true,
            totalEventsWidthPercentInOneColumn: 95,
            newEventText: 'title',
            url: url,
            height: function ($calendar) {
                return $(window).height() - $('h1').outerHeight(true);
            },
            eventRender: function (calEvent, $event) {
                if (calEvent.date.getTime() < new Date().getTime()) {
                    $event.css('background', 'none');
                    $event.css('backgroundColor', '#a29ec1');
                    $event.find('wc-time').css({
                        background:  'none',
                        border: '1px solid #888'
                    });
                }
            },


        });
        function displayMessage(message) {
            $('#message').html(message).fadeIn();
        }

        $('<div id="message" class="ui-corner-all"></div>').prependTo($('body'));
    }

    function loadTable() {
        var days = Date.getDaysInMonth(new Date().getFullYear(), new Date().getMonth());
        var scheduleNum = 5;
        for (var i = 1; i < days + 1; i++) {
            var day = '<tr><td rowspan="' + scheduleNum + '"> 6月' + i + '日</td>';
            var route = '';
            for (var k = 0; k < 5; k++) {
                if (k != 0) {
                    route += '<tr>';
                }
                route += '<td>线路A</td><td>司机A</td><td>沪A2244</td>线路A<td>7:00 am-9:00 am</td><td><span class="label label-success">已到岗</span></td>';
                route += '</tr>';
            }
            $("#tableBody").append(day + route);
        }
    }
</script>
</body>
</html>
