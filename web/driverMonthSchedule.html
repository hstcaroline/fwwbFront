<!DOCTYPE html>
<!--[if IE 8]>
<html lang="en" class="ie8 no-js"> <![endif]-->
<!--[if IE 9]>
<html lang="en" class="ie9 no-js"> <![endif]-->
<!--[if !IE]><!-->
<html lang="en" class="no-js"> <!--<![endif]-->
<!-- BEGIN HEAD -->
<head>
    <meta charset="utf-8"/>
    <title>司机排班 | 厂车管理系统</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <meta content="" name="description"/>
    <meta content="" name="author"/>
    <!-- BEGIN GLOBAL MANDATORY STYLES -->
    <link href="media/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
    <link href="media/css/bootstrap-responsive.min.css" rel="stylesheet" type="text/css"/>
    <link href="media/css/font-awesome.min.css" rel="stylesheet" type="text/css"/>
    <link href="media/css/style-metro.css" rel="stylesheet" type="text/css"/>
    <link href="media/css/style.css" rel="stylesheet" type="text/css"/>
    <link href="media/css/style-responsive.css" rel="stylesheet" type="text/css"/>
    <link href="media/css/default.css" rel="stylesheet" type="text/css" id="style_color"/>
    <link href="media/css/uniform.default.css" rel="stylesheet" type="text/css"/>
    <!-- END GLOBAL MANDATORY STYLES -->
    <link rel='stylesheet' type='text/css' href='media/css/jquery-ui-1.8.11.custom.css'/>
    <!-- END GLOBAL MANDATORY STYLES -->
    <link rel="stylesheet" href="media/css/DT_bootstrap.css">
    <link rel="stylesheet" type="text/css" href="media/css/select2_metro.css"/>
    <link href="media/css/mystyle.css" rel="stylesheet" type="text/css"/>
</head>
<!-- END HEAD -->

<!-- BEGIN BODY -->
<body class="page-header-fixed page-full-width">
<!-- BEGIN HEADER -->
<div class="header navbar navbar-inverse navbar-fixed-top">

    <!-- BEGIN TOP NAVIGATION BAR -->

    <div class="navbar-inner">

        <div class="container-fluid">

            <!-- BEGIN LOGO -->
            <a class="brand" href="index.html">
                <img src="media/image/logo.png" alt="logo">
            </a>
            <!-- END LOGO -->
            <!-- BEGIN HORIZANTAL MENU -->
            <div class="navbar hor-menu hidden-phone hidden-tablet">
                <div class="navbar-inner">
                    <ul class="nav">
                        <li>
                            <a href="index.html">
                                线路规划
                            </a>
                        </li>
                        <li>
                            <a href="realTime.html">
                                运行动态
                            </a>
                        </li>
                        <li class="active">

                            <a data-toggle="dropdown" class="dropdown-toggle" href="javascript:;">

                                <span class="selected"></span>

                                目录

                                <span class="arrow"></span>

                            </a>

                            <ul class="dropdown-menu">

                                <li class="dropdown-submenu">

                                    <a href="javascript:;">

                                        数据查询

                                        <span class="arrow"></span>

                                    </a>

                                    <ul class="dropdown-menu">
                                        <li>
                                            <a href="stationInfo.html">
                                                所有站点</a>
                                        </li>
                                        <li>
                                            <a href="rideList.html">
                                                乘车名单</a>
                                        </li>
                                        <li class="dropdown-submenu">
                                            <a href="javascript:;">
                                                报表
                                                <span class="arrow"></span>
                                            </a>
                                            <ul class="dropdown-menu">
                                                <li><a href="reportChart.html"> 所有站点</a></li>
                                                <li><a href="stationReportChart.html"> 站点详情</a></li>
                                            </ul>
                                        </li>
                                    </ul>

                                </li>
                                <li class="dropdown-submenu">

                                    <a href="javascript:;">

                                        信息管理

                                        <span class="arrow"></span>
                                    </a>

                                    <ul class="dropdown-menu">

                                        <li>
                                            <a href="staffInfo.html">
                                                员工</a>
                                        </li>
                                        <li>
                                            <a href="carInfo.html">
                                                车辆</a></li>
                                        <li>
                                            <a href="driverSchedule.html">
                                                司机排班</a>
                                        </li>

                                    </ul>

                                </li>
                                <li class="dropdown-submenu">

                                    <a href="javascript:;">

                                        系统管理

                                        <span class="arrow"></span>
                                    </a>

                                    <ul class="dropdown-menu">
                                        <li class="dropdown-submenu">
                                            <a href="javascript:;">角色管理<span class="arrow"></span></a>
                                            <ul class="dropdown-menu">
                                                <li ><a href="role_create.html"> 创建角色</a></li>
                                                <li><a href="authorityMng.html"> 角色权限</a></li>
                                            </ul>
                                        </li>
                                        <li class="dropdown-submenu">
                                            <a href="javascript:;">用户管理<span class="arrow"></span></a>
                                            <ul class="dropdown-menu">
                                                <li ><a href="register.html"> 创建用户</a></li>
                                                <li ><a href="role_edit.html"> 用户角色</a></li>
                                            </ul>
                                        </li>
                                    </ul>

                                </li>

                                <li class="dropdown-submenu">

                                    <a href="javascript:;">

                                        个人中心

                                        <span class="arrow"></span>

                                    </a>

                                    <ul class="dropdown-menu">

                                        <li class="dropdown-submenu">

                                            <a href="javascript:;">个人账户<span class="arrow"></span></a>

                                            <ul class="dropdown-menu">

                                                <li><a href="userProfile.html">个人资料</a></li>

                                                <li><a href="changePsw.html">更改密码</a></li>
                                            </ul>

                                        </li>

                                        <li class="dropdown-submenu">

                                            <a href="javascript:;">我的日程<span class="arrow"></span></a>

                                            <ul class="dropdown-menu">

                                                <li><a href="index.html">待办事项</a></li>

                                                <li><a href="index.html">全部日程</a></li>
                                                <li><a href="index.html">新建任务</a></li>
                                            </ul>

                                        </li>
                                        <li class="dropdown-submenu">

                                            <a href="javascript:;">我的日程<span class="arrow"></span></a>

                                            <ul class="dropdown-menu">

                                                <li><a href="index.html">消息中心</a></li>

                                                <li><a href="index.html">申请与建议</a></li>
                                                <li><a href="index.html">收件箱</a></li>
                                                <li><a href="index.html">发件箱</a></li>
                                            </ul>

                                        </li>


                                    </ul>

                                </li>

                                <li>

                                    <a href="news.html">
                                        公司动态 </a>

                                </li>

                            </ul>

                            <b class="caret-out"></b>

                        </li>


                    </ul>

                </div>
            </div>


            <!-- END HORIZANTAL MENU -->

            <!-- BEGIN TOP NAVIGATION MENU -->

            <ul class="nav pull-right">
                <!-- BEGIN TODO DROPDOWN -->
                <li class="dropdown" id="header_task_bar">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                        <i class="icon-tasks"></i>
                        <span class="badge">4</span>
                    </a>
                    <ul class="dropdown-menu extended tasks">
                        <li>
                            <p>您有 4 个更新状态</p>
                        </li>
                        <li>
                            <a href="#">
                                        <span class="task">
                                        <span class="desc">车辆信息更新</span>
                                        <span class="percent">40%</span>
                                        </span>
                                        <span class="progress progress-success ">
                                        <span style="width: 40%;" class="bar"></span>
                                        </span>
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                    <span class="task">
                                    <span class="desc">员工信息更新</span>
                                    <span class="percent">65%</span>
                                    </span>
                                    <span class="progress progress-danger progress-striped active">
                                    <span style="width: 65%;" class="bar"></span>
                                    </span>
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                    <span class="task">
                                    <span class="desc">排班信息更新</span>
                                    <span class="percent">10%</span>
                                    </span>
                                    <span class="progress progress-warning progress-striped">
                                    <span style="width: 10%;" class="bar"></span>
                                    </span>
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                    <span class="task">
                                    <span class="desc">站点信息更新</span>
                                    <span class="percent">30%</span>
                                    </span>
                                    <span class="progress progress-info progress-striped">
                                    <span style="width: 30%;" class="bar"></span>
                                    </span>
                            </a>
                        </li>
                        <li class="external">
                            <a href="timeSchedule.html">修改更新计划 <i class="m-icon-swapright"></i></a>
                        </li>
                    </ul>
                </li>
                <!-- END TODO DROPDOWN -->

                <!-- BEGIN INBOX DROPDOWN -->
                <li class="dropdown" id="header_inbox_bar">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                        <i class="icon-envelope"></i>
                        <span class="badge">12</span>
                    </a>
                    <ul class="dropdown-menu extended inbox">
                        <li>
                            <p>您有12条未读消息</p>
                        </li>
                        <li>
                            <a href="inbox.html?a=view">
                                <span class="photo"><img src="media/image/avatar2.jpg" alt=""/></span>
                                        <span class="subject">
                                        <span class="from">刘婷</span>
                                        <span class="time">刚刚</span>
                                        </span>
                                        <span class="message">
                                       排班信息更改请求...
                                        </span>
                            </a>
                        </li>
                        <li>
                            <a href="inbox.html?a=view">
                                <span class="photo"><img src="./media/image/avatar3.jpg" alt=""/></span>
                                    <span class="subject">
                                    <span class="from">李宁</span>
                                    <span class="time">16 分钟以前</span>
                                    </span>
                                    <span class="message">
                                    站点变更请求...
                                    </span>
                            </a>
                        </li>
                        <li>
                            <a href="inbox.html?a=view">
                                <span class="photo"><img src="./media/image/avatar1.jpg" alt=""/></span>
                                    <span class="subject">
                                    <span class="from">黄雷</span>
                                    <span class="time">2 小时以前</span>
                                    </span>
                                    <span class="message">
                                    数据更新请求...
                                    </span>
                            </a>
                        </li>
                        <li class="external">
                            <a href="#">查看所有消息 <i class="m-icon-swapright"></i></a>
                        </li>
                    </ul>
                </li>
                <!-- END INBOX DROPDOWN -->

                <!-- BEGIN USER LOGIN DROPDOWN -->
                <li class="dropdown user">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                        <img alt="" src="media/image/avatar1_small.jpg"/>
                        <span class="username">曾林（Pyxister管理员）</span>
                        <i class="icon-angle-down"></i>
                    </a>
                    <ul class="dropdown-menu">
                        <li><a href="userProfile.html"><i class="icon-user"></i> 个人资料</a></li>
                        <li><a href="page_calendar.html"><i class="icon-calendar"></i> 我的日程</a></li>
                        <li><a href="inbox.html"><i class="icon-envelope"></i> 我的消息 (12)</a></li>
                        <li><a href="#"><i class="icon-tasks"></i> 待办事项 (3)</a></li>
                        <li class="divider"></li>
                        <li><a href="extra_lock.html"><i class="icon-lock"></i> 锁屏</a></li>
                        <li><a href="login.html"><i class="icon-power-off"></i> 注销</a></li>
                    </ul>
                </li>
                <!-- END USER LOGIN DROPDOWN -->
            </ul>

            <!-- END TOP NAVIGATION MENU -->

        </div>

    </div>

    <!-- END TOP NAVIGATION BAR -->

</div>
<!-- END HEADER -->
<!-- BEGIN CONTAINER -->
<div class="page-container">
    <!-- BEGIN PAGE -->
    <div class="page-content">
        <div class="container-fluid">
            <div class="row-fluid">
                <div class="span12">
                </div>
            </div>
            <!--开始内容-->
            <div class="row-fluid">
                <div class="portlet box red">

                    <div class="portlet-title">

                        <div class="caption"><i class="icon-globe"></i>月排班表
                            <!--<button class="btn blue">上一月 <i class="m-icon-swapleft"></i></button>-->
                            <!--<button class="btn green">当前月 <i class="icon-home"></i></button>-->
                            <!--<button class="btn purple">下一月 <i class="m-icon-swapright m-icon-white"></i></button>-->
                            <!--<div class="controls">-->
                            <select class="yearSelect" id="year">
                                <option value="2016">2016年</option>
                                <option value="2015">2015年</option>
                                <option value="2014">2014年</option>
                            </select>
                            <select class="yearSelect" id="month">
                                <option value="0">1月</option>
                                <option value="1">2月</option>
                                <option value="2">3月</option>
                                <option value="3">4月</option>
                                <option value="4">5月</option>
                                <option value="5">6月</option>
                                <option value="6" selected="selected">7月</option>
                                <option value="7">8月</option>
                                <option value="8">9月</option>
                                <option value="9">10月</option>
                                <option value="10">11月</option>
                                <option value="11">12月</option>
                            </select>
                            <button class="btn blue" id="goSearch">确定</button>
                            <!--</div>-->
                        </div>

                        <div class="tools">


                            <a href="javascript:;" class="reload"></a>

                            <a href="javascript:;" class="remove"></a>

                        </div>
                    </div>
                    <div class="portlet-body">
                        <table class="table table-striped table-bordered table-hover table-full-width"
                               id="monthScheduleTable">
                            <thead>
                            <tr>
                                <th>日期</th>
                                <th>时间段</th>
                                <th>线路</th>
                                <th>司机信息</th>
                                <th>车辆信息</th>
                                <th>出勤情况</th>
                            </tr>
                            </thead>
                            <tbody id="tableBody">

                            </tbody>
                        </table>
                    </div>
                    <div id="modal_remove" class="modal hide fade" tabindex="-1" data-backdrop="static"
                         data-keyboard="false">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                            <h3>注意</h3>
                        </div>
                        <div class="modal-body">
                            <h5>此操作不可撤销，确定删除此用户?</h5>
                        </div>
                        <div class="modal-footer">
                            <button type="button" data-dismiss="modal" class="btn mini">取消</button>
                            <button type="button" data-dismiss="modal" class="btn red mini" id="remove">删除</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- END PAGE CONTAINER-->

</div>
<!-- END PAGE -->
<!-- END CONTAINER -->

<!-- BEGIN JAVASCRIPTS(Load javascripts at bottom, this will reduce page load time) -->
<!-- BEGIN CORE PLUGINS -->

<script src="media/js/jquery-1.10.1.min.js" type="text/javascript"></script>
<script src="media/js/jquery-migrate-1.2.1.min.js" type="text/javascript"></script>
<!-- IMPORTANT! Load jquery-ui-1.10.1.custom.min.js before bootstrap.min.js to fix bootstrap tooltip conflict with jquery ui tooltip -->
<script src="media/js/jquery-ui-1.10.1.custom.min.js" type="text/javascript"></script>
<script src="media/js/bootstrap.min.js" type="text/javascript"></script>
<!--[if lt IE 9]>
<script src="media/js/excanvas.min.js"></script>
<script src="media/js/respond.min.js"></script>
<![endif]-->
<script src="media/js/calendar/date.js"></script>
<script type="text/javascript" src="media/js/select2.min.js"></script>
<script type="text/javascript" src="media/js/jquery.dataTables.min.js"></script>
<script type="text/javascript" src="media/js/DT_bootstrap.js"></script>
<script src="media/js/jquery.blockui.min.js" type="text/javascript"></script>
<script src="media/js/monthSchedule.js"></script>
<script src="media/js/app.js"></script>

<script type='text/javascript'>

    var totalDays;
    var extralData;
    $(document).ready(function () {
        getData();
        App.init();
        TableAdvanced.init(extralData);
    });

    function loadTable(data) {
        var scheduleData = formatData(data);
        var html = '';
        for (var i = 1; i < totalDays + 1; i++) {
            html += '<tr id="' + (i - 1) + '">';
            //日期列
            html += '<td>' + i + '</td>';
            var length = scheduleData[i - 1].driverRoute.length;
            //有排班信息
            if (length > 0) {
                var firstRoute = scheduleData[i - 1].driverRoute[0];
                var timeSlot = formatTime(firstRoute.route.time);
                //信息列
                html += ' <td> ' + timeSlot + '</td> '
                        + '<td>' + firstRoute.route.name + '</td> '
                        + '<td>' + firstRoute.driver.name + '</td>'
                        + '<td >' + firstRoute.bus.plate_number + '</td>'
                        + '<td style="vertical-align: middle;text-align: center"><a href="javascript:;" class="btn red mini delete"><i class="icon-trash"></i> 删除</a></td> '
                        + '</tr>';
                //还有未显示的数据
                if (length > 1) {
                    extralData.push(scheduleData[i - 1]);
                }
            } else {
                html += ' <td> 无排班信息</td> '
                        + ' <td>&nbsp;</td> '
                        + '<td>&nbsp;</td>'
                        + '<td > &nbsp;</td>'
                        + '<td style="vertical-align: middle;text-align: center"><a href="javascript:;" class="btn red mini delete"><i class="icon-trash"></i> 删除</a></td> ' +
                        '</tr>';
            }
        }
        $("#tableBody").html(html);
    }
    function getData() {
        var year = $("#year").val();
        var month = $("#month").val();
        totalDays = Date.getDaysInMonth(year, month);
        extralData = new Array();
        var startDate = new Date(year, month, 1);
        var endDate = new Date(year, month, totalDays);
        postData = JSON.stringify({startdate: startDate, enddate: endDate});
        $.ajax({
            url: ip + '/users/getRouteDriverByDate',
            type: 'POST',
            async: false,
            data: postData,
            dataType: 'json',
            contentType: "application/json",
            success: function (schedule) {
                if (schedule != null) {
                    loadTable(schedule);

                }
                else {
                    alert('链接失败');
                }
            },
            error: function (xhr, type, exception) {
                alert(type);
            }
        });
    }
    function formatData(schedule) {
        var array = new Array();
        for (var i = 1; i < totalDays + 1; i++) {
            var data = {day: i, driverRoute: []};
            array.push(data);
            for (var j in schedule) {
                var scheduleDate = new Date(schedule[j].date);
                if (scheduleDate.getDate() == i) {
                    array[i - 1].driverRoute.push(schedule[j]);
                }
            }
        }
        return array;
    }

    $("#goSearch").click(function () {
        getData();
        load(extralData);

    })
</script>
</body>
</html>
