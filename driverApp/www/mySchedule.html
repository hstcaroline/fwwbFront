<!doctype html>
<!--[if IE 8]>
<html class="ie8 lt-ie10"><![endif]-->
<!--[if IE 9]>
<html class="ie9 lt-ie10"><![endif]-->
<!--[if gt IE 9]><!-->
<html lang="en"><!--<![endif]-->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="cleartype" content="on">
    <meta name="MobileOptimized" content="320">
    <meta name="HandheldFriendly" content="True">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <link rel="stylesheet" href="css/mocha.min.css">
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/font-awesome.css">
    <link rel="stylesheet" href="css/test.css">
    <link rel="stylesheet" href="css/slideout.css">
    <link rel="stylesheet" href="css/myStyle.css">
</head>
<body>

<nav id="menu" class="menu">
    <div class="menu_header" id="menu_header" style="display: none;">
        <div class="imgDiv">
            <img src="img/head.png" class="img-circle" style="width: 25%">
            <span class="nameText">常旅客</span>
        </div>
    </div>

    <section class="menu-section" id="menu_section" style="display: none;">
        <ul class="menu-section-list">
            <li id="myInfo" onclick="menuClick(this.id)">
                <img src="img/icon-info.png" class="menu-icon">
                <span class="menu-span">我的资料</span>
            </li>
            <li id="myCar" onclick="menuClick(this.id)">
                <img src="img/icon-drive.png" class="menu-icon">
                <span class="menu-span">我的车辆</span>
            </li>
            <li id="myCash" onclick="menuClick(this.id)">
                <img src="img/icon-cash.png" class="menu-icon">
                <span class="menu-span">我的工资</span>
            </li>
            <li id="myMsg" onclick="menuClick(this.id)">
                <img src="img/icon-message.png" class="menu-icon">
                <span class="menu-span">我的消息</span>
            </li>
            <li id="news" onclick="menuClick(this.id)">
                <img src="img/icon-news.png" class="menu-icon">
                <span class="menu-span">公司动态</span>
            </li>
        </ul>
    </section>
</nav>

<main id="panel" style="height: 100%">
    <!--<div class="panel-header">-->
    <div class="header">
        <div style="height: 100%;width:30%;margin-top: 2%;float: left">
            <img src="img/head.png" class="img-circle img-head js-slideout-toggle">
        </div>
        <div style="height: 100%;width:70%;float: right">
            <span class="text-center">我的排班</span>
        </div>
    </div>
    <!--</div>-->
    <div class="wc-container">
        <div class="ui-widget-header wc-toolbar" style="text-align: center">
            <i class="icon-angle-left" onclick=getWeekNum(-6,0,'weekStartTime','weekEndTime')></i>
            <span class="wc-title" id="weekStartTime" onclick="getWeekNum(1,7,'weekStartTime','weekEndTime')"></span>到
            <span class="wc-title" id="weekEndTime" onclick="getWeekNum(1,7,'weekStartTime','weekEndTime')"></span>
            <i class="icon-angle-right" onclick=getWeekNum(8,14,'weekStartTime','weekEndTime');></i>
        </div>

        <div class="ui-widget-content wc-header">
            <table class="gridWeek" style="margin-bottom: 0px;background-color: transparent">
                <tbody>
                <tr>
                    <td class="wc-time-column-header" style="width: 50px"></td>
                    <td class="wc-day-column-header wc-day-1">一</td>
                    <td class="wc-day-column-header wc-day-2">二</td>
                    <td class="wc-day-column-header wc-day-3">三</td>
                    <td class="wc-day-column-header wc-day-4">四</td>
                    <td class="wc-day-column-header wc-day-5">五</td>
                    <td class="wc-day-column-header wc-day-6">六</td>
                    <td class="wc-day-column-header wc-day-7">日</td>
                </tr>
                </tbody>
            </table>
        </div>

    </div>
    <div style="height: 70%;overflow: auto">
        <div class="wc-container">
            <table class="gridTable">
                <tbody id="scheduleTbody">
                <tr id="">
                    <td>00:00-02:00</td>
                    <td><a href="index.html">
                        <div class="work">线路1</div>
                    </a></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                </tr>

                </tbody>
            </table>
        </div>

    </div>
    <div class="footer">
        <ul class="nav nav-tabs" style="height: 100%">
            <li>
                <a id="footer_a1" onclick="footerClick(this.id)"> <img id="footer_img1" class="footer-img"
                                                                       src="img/icon_location_normal.png"/></a>
            </li>

            <li class=""><a id="footer_a2" onclick="footerClick(this.id)"> <img class="footer-img"
                                                                                src="img/icon_user_checked.png"/></a>
            </li>

            <li class=""><a id="footer_a3" onclick="footerClick(this.id)"> <img class="footer-img"
                                                                                src="img/icon-readCard-normal.png"/></a>
            </li>

        </ul>
    </div>
</main>

<!--<script>-->
<!--mocha.setup('bdd');-->
<!--var exports = null;-->
<!--function assert(expr, msg) {-->
<!--if (!expr) throw new Error(msg || 'failed');-->
<!--}-->
<!--</script>-->
<script type="text/javascript" src="js/jquery-2.0.0.min.js"></script>
<script type="text/javascript" src="js/jquery.cookie.js"></script>
<script src="js/slideout.js"></script>
<script src="js/myJs.js"></script>
<script src="js/test.js"></script>
<script src="js/date.js"></script>
<script>
    var startTime;
    window.onload = function () {
        var driverId = $.cookie('userId');
        alert(driverId);
        $('#menu_header').show();
        $('#menu_section').show();
        getWeekNum(1, 7, 'weekStartTime', 'weekEndTime');
        document.querySelector('.js-slideout-toggle').addEventListener('click', function () {
            slideout.toggle();
        });
        startTime = $("#weekStartTime").text();
        var endTime = $("#weekEndTime").text();
        var postData = JSON.stringify({id: driverId, startdate: startTime, enddate: endTime});
        $.ajax({
            url: ip + 'users/getRouteDriver',
            type: 'POST',
            async: false,
            data: postData,
            dataType: 'json',
            contentType: "application/json",
            success: function (driver) {
                if (driver != null) {
                    // alert(driver);
                    loadTable(driver);
                }
                else {
                    alert('链接失败');
                }
            },
            error: function (xhr, type, exception) {
                alert(type);
            }
        });
    };
    function loadTable(data) {
        var html = '';
        for (var i = 1; i < 13; i++) {
            html += '<tr id="tr' + i + '">'
                    + '<td style="width: 50px">' + formatTime(i) + '</td>'
                    + '<td id="td' + i + '-1">&nbsp;</td>'
                    + '<td id="td' + i + '-2">&nbsp;</td>'
                    + '<td id="td' + i + '-3">&nbsp;</td>'
                    + '<td id="td' + i + '-4">&nbsp;</td>'
                    + '<td id="td' + i + '-5">&nbsp;</td>'
                    + '<td id="td' + i + '-6">&nbsp;</td>'
                    + '<td id="td' + i + '-7">&nbsp;</td>'
            '</tr>';
        }
        $("#scheduleTbody").html(html);
        for (var i in data) {
            var date = new Date(data[i].date);
            //相差天数,找到对应id
            var days = Math.floor(Math.abs((new Date(startTime).getTime() - date.getTime())) / (1000 * 60 * 60 * 24)) + 1;
            var innerHtml = ' <div class="work" onclick="showInMap(' + data[i].route.id + ')">' + data[i].route.id + '号线</div>';
            var trId = data[i].route.time;
            var tdId = 'td' + trId + '-' + days;
            $("#" + tdId).html(innerHtml);
        }
    }
    function showInMap(routeId) {
        $.cookie('routeId',routeId,{expires: 7, path: '/'});
        window.location.href = 'index.html?routeId=' + routeId;
    }
</script>
</body>
</html>